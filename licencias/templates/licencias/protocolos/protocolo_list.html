{% extends "licencias/base.html" %}

{% block title %}Relación de Protocolos | SEGEY Licencias{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1 class="page-title">Relación de Protocolos</h1>
        <p class="lead">Registro de casos atendidos en nivel secundarias con vínculo a su CCT correspondiente.</p>
    </div>
    {% if perms.licencias.add_relacionprotocolo %}
    <a class="btn btn--primary btn--md" href="{% url 'licencias:protocolo-create' %}">Registrar protocolo</a>
    {% endif %}
</div>

<section class="filters">
    <form method="get">
        <div class="filter-grid">
            {% for field in filter.form.visible_fields %}
            <div class="filter-field">
                <label>{{ field.label }} {{ field }}</label>
            </div>
            {% endfor %}
        </div>
        <button type="submit" class="btn btn--primary btn--sm">Aplicar filtros</button>
    </form>
</section>

<table class="table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Fecha</th>
            <th>Nombre del NNA</th>
            <th>CCT</th>
            <th>Escuela</th>
            <th>Tipo de violencia</th>
            <th>Estatus</th>
            <th>Asesor jurídico</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for protocolo in protocolos %}
        <tr>
            <td>{{ protocolo.numero_registro }}</td>
            <td>{{ protocolo.fecha_inicio|date:"d/m/Y" }}</td>
            <td><a href="{% url 'licencias:protocolo-detail' protocolo.pk %}">{{ protocolo.nombre_nna }}</a></td>
            <td>{{ protocolo.cct.cct }}</td>
            <td>{{ protocolo.escuela }}</td>
            <td>{{ protocolo.tipo_violencia|default:"-" }}</td>
            <td><span class="chip">{{ protocolo.get_estatus_display }}</span></td>
            <td>{{ protocolo.asesor_juridico|default:"-" }}</td>
            <td class="table-actions">
                <a href="{% url 'licencias:protocolo-detail' protocolo.pk %}">Ver</a>
                {% if perms.licencias.change_relacionprotocolo %}
                <a href="{% url 'licencias:protocolo-update' protocolo.pk %}">Editar</a>
                {% endif %}
                {% if perms.licencias.delete_relacionprotocolo %}
                <a href="{% url 'licencias:protocolo-delete' protocolo.pk %}">Eliminar</a>
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="9">No hay protocolos registrados.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if is_paginated %}
<div class="pagination">
    {% if page_obj.has_previous %}
    <a class="pagination__button" href="?{% if request.GET %}{{ request.GET.urlencode }}&amp;{% endif %}page={{ page_obj.previous_page_number }}" aria-label="Página anterior">&larr;</a>
    {% endif %}
    <span class="pagination__page pagination__page--current">Página {{ page_obj.number }} de {{ paginator.num_pages }}</span>
    {% if page_obj.has_next %}
    <a class="pagination__button" href="?{% if request.GET %}{{ request.GET.urlencode }}&amp;{% endif %}page={{ page_obj.next_page_number }}" aria-label="Página siguiente">&rarr;</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}
