{% extends "licencias/base.html" %}
{% load form_tags %}

{% block title %}Detalle del interno {{ control.numero_interno }} | SEGEY Licencias{% endblock %}

{% block content %}
<section class="module-shell module-shell--form">
    <div class="module-shell__header">
        <div class="module-shell__intro">
            <p class="module-shell__eyebrow">Jurídico · Secundarias</p>
            <div class="module-shell__headline-group">
                <h1 class="module-shell__title">Interno {{ control.numero_interno }}</h1>
                <p class="module-shell__lead">Consulta la información completa del memorándum y los cambios de estatus registrados para el centro de trabajo.</p>
            </div>
        </div>
        <div class="module-shell__actions">
            {% if perms.licencias.change_controlinterno %}
            <a class="btn btn--primary btn--md" href="{% url 'licencias:controlinterno-update' control.pk %}">Editar</a>
            {% endif %}
            <a class="btn btn--ghost btn--md" href="{% url 'licencias:controlinterno-list' %}">Volver al listado</a>
        </div>
    </div>

    <div class="tramite-form-container">
        <div class="tramite-form">
            <div class="data-grid">
                <div class="data-item">
                    <span class="data-label">Memorándum</span>
                    <span class="data-value">{{ control.memorandum }}</span>
                </div>
                <div class="data-item">
                    <span class="data-label">Número interno</span>
                    <span class="data-value">{{ control.numero_interno }}</span>
                </div>
                <div class="data-item">
                    <span class="data-label">Fecha memorándum</span>
                    <span class="data-value">{{ control.fecha_memorandum|date:"d/m/Y"|default:"-" }}</span>
                </div>
                <div class="data-item">
                    <span class="data-label">Año</span>
                    <span class="data-value">{{ control.anio }}</span>
                </div>
                <div class="data-item">
                    <span class="data-label">CCT</span>
                    <span class="data-value">{{ control.cct.cct }} · {{ control.cct_nombre }}</span>
                </div>
                <div class="data-item">
                    <span class="data-label">Sistema</span>
                    <span class="data-value">{{ control.sostenimiento_c_subcontrol|default:"-" }}</span>
                </div>
                <div class="data-item">
                    <span class="data-label">Modalidad</span>
                    <span class="data-value">{{ control.tiponivelsub_c_servicion3|default:"-" }}</span>
                </div>
                <div class="data-item">
                    <span class="data-label">Asesor</span>
                    <span class="data-value">{{ control.asesor|default:"-" }}</span>
                </div>
                <div class="data-item">
                    <span class="data-label">Fecha de creación</span>
                    <span class="data-value">{{ control.creado_en|date:"d/m/Y H:i" }}</span>
                </div>
                <div class="data-item">
                    <span class="data-label">Última modificación</span>
                    <span class="data-value">{{ control.actualizado_en|date:"d/m/Y H:i" }}</span>
                </div>
            </div>

            {% if control.observaciones %}
            <section class="form-subsection">
                <h2 class="section-title">Observaciones</h2>
                <p>{{ control.observaciones }}</p>
            </section>
            {% endif %}
            {% if control.comentarios %}
            <section class="form-subsection">
                <h2 class="section-title">Comentarios</h2>
                <p>{{ control.comentarios }}</p>
            </section>
            {% endif %}
        </div>
    </div>

    <div class="module-table-card">
        <div class="module-table-card__header">
            <h2 class="module-table-card__title">Historial de estatus</h2>
            <p class="module-table-card__meta">Se conserva cada actualización con sello de tiempo y usuario responsable.</p>
        </div>
        <table class="table">
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Registrado por</th>
                    <th>Estatus anterior</th>
                    <th>Estatus nuevo</th>
                </tr>
            </thead>
            <tbody>
                {% for entrada in estatus_historial %}
                <tr>
                    <td>{{ entrada.cambiado_en|date:"d/m/Y H:i" }}</td>
                    <td>{{ entrada.cambiado_por|default:"-" }}</td>
                    <td>{{ entrada.estatus_anterior|default:"(sin estatus)" }}</td>
                    <td>
                        <span class="status-chip status-chip--{{ entrada.estatus_nuevo|slugify }}">{{ entrada.estatus_nuevo }}</span>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="table__empty">No hay cambios de estatus registrados.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</section>
{% endblock %}
