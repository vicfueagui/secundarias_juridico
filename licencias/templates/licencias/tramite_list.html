{% extends "licencias/base.html" %}

{% block title %}Trámites | SEGEY Licencias{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Trámites registrados</h1>
    <p class="lead">Supervisa folios, actualiza estados y gestiona prórrogas con seguimiento oportuno.</p>
</div>
<section class="filters">
    <form method="get">
        <div class="filter-grid">
            {% for field in filter.form.visible_fields %}
            <div class="filter-field">
                <label>{{ field.label }} {{ field }}</label>
            </div>
            {% endfor %}
        </div>
        <button type="submit" class="btn btn--primary btn--sm">Aplicar filtros</button>
    </form>
</section>

<table class="table">
    <thead>
        <tr>
            <th>Folio</th>
            <th>Trabajador</th>
            <th>Tipo</th>
            <th>Subsistema</th>
            <th>Etapa</th>
            <th>Resultado</th>
            <th>Actualizado</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for tramite in tramites %}
        <tr>
            <td><a href="{% url 'licencias:tramite-detail' tramite.pk %}">{{ tramite.folio }}</a></td>
            <td>{{ tramite.trabajador_nombre }}</td>
            <td>{{ tramite.tipo_tramite }}</td>
            <td>{{ tramite.subsistema }}</td>
            <td>{{ tramite.estado_actual }}</td>
            <td>{{ tramite.resultado_resolucion|default:"-" }}</td>
            <td>{{ tramite.updated_at|date:"d/m/Y H:i" }}</td>
            <td class="table-actions">
                <a href="{% url 'licencias:tramite-detail' tramite.pk %}">Ver</a>
                {% if perms.licencias.change_tramite %}
                <a href="{% url 'licencias:tramite-update' tramite.pk %}">Editar</a>
                {% endif %}
                {% if perms.licencias.delete_tramite %}
                <a href="{% url 'licencias:tramite-delete' tramite.pk %}">Eliminar</a>
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="8">Sin trámites registrados.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if is_paginated %}
<div class="pagination">
    {% if page_obj.has_previous %}
    <a href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}page={{ page_obj.previous_page_number }}">Anterior</a>
    {% endif %}
    <span>Página {{ page_obj.number }} de {{ paginator.num_pages }}</span>
    {% if page_obj.has_next %}
    <a href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}page={{ page_obj.next_page_number }}">Siguiente</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}
