{% extends "licencias/base.html" %}

{% block title %}Editar reporte · Incidencia {{ object.numero }}{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <span class="chip">Herramienta · Reporteador</span>
        <h1 class="page-title">Previsualizar reporte</h1>
        <p>{{ plantilla.titulo }}</p>
    </div>
    <div class="page-actions">
        <a class="btn btn--ghost" href="{% url 'incidencias:incidencia-list' %}">Regresar</a>
        <a class="btn btn--primary" href="{% url 'incidencias:incidencia-reporte-pdf' object.pk %}" target="_blank" rel="noopener">Generar PDF</a>
    </div>
</div>

<div class="split-grid">
    <section class="card">
        <div class="card__body">
            <h2 class="section-title">Resumen de la incidencia</h2>
            <dl class="data-list">
                <div>
                    <dt>No.</dt>
                    <dd>{{ object.numero }}</dd>
                </div>
                <div>
                    <dt>Nombre completo</dt>
                    <dd>{{ object.nombre_completo }}</dd>
                </div>
                <div>
                    <dt>RFC</dt>
                    <dd>{{ object.rfc }}</dd>
                </div>
            </dl>
            <div class="table-scroll">
                <table class="table table--compact">
                    <tbody>
                    {% for label, value in tabla_datos %}
                        <tr>
                            <th>{{ label }}</th>
                            <td>{{ value }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <section class="card">
        <div class="card__body">
            <h2 class="section-title">Cuerpo editable</h2>
            <p class="help-text">Este texto se guardará junto con la incidencia y se usará para generar el PDF.</p>
            <form method="post">
                {% csrf_token %}
                {{ form.non_field_errors }}
                {{ form.cuerpo_personalizado }}
                {% if form.cuerpo_personalizado.errors %}
                <div class="errorlist">
                    {% for error in form.cuerpo_personalizado.errors %}<p>{{ error }}</p>{% endfor %}
                </div>
                {% endif %}
                <div class="form-actions">
                    <button type="submit" class="btn btn--primary">Guardar cambios</button>
                </div>
            </form>
        </div>
    </section>
</div>

<section class="card">
    <div class="card__body">
        <h2 class="section-title">Previsualización</h2>
        <article class="report-preview">
            {% if plantilla.logo %}
            <img class="report-preview__logo" src="{{ plantilla.logo.url }}" alt="Logo">
            {% endif %}
            <p class="report-preview__title">{{ plantilla.titulo }}</p>
            <div class="report-preview__body">
                {{ cuerpo_resuelto|safe }}
            </div>
        </article>
    </div>
</section>
{% endblock %}
